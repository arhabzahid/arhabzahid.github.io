<!DOCTYPE html>
<html>
<head>
  <title>Newspaper Titles</title>
</head>
<body>
  <h1>Newspaper Titles</h1>
  <ul id="titles-list"></ul>

  <script>
    const url = 'https://corsproxy.io/?https://chroniclingamerica.loc.gov/newspapers/feed/';

    fetch(url)
      .then(response => {
        console.log("Response status:", response.status);  // Check if the fetch succeeded
        return response.text();
      })
      .then(str => {
        console.log("Raw XML:", str);  // Log the raw XML response to debug
        const parser = new DOMParser();
        const xml = parser.parseFromString(str, 'application/xml');
        
        // Check if the XML is correctly parsed
        const parserError = xml.querySelector('parsererror');
        if (parserError) {
          console.error('XML Parsing Error:', parserError.textContent);
          document.getElementById('titles-list').innerHTML = '<li>Failed to parse XML.</li>';
          return;
        }
        
        const items = xml.getElementsByTagName('item');
        console.log("Number of items found:", items.length);  // Log number of items found
        const list = document.getElementById('titles-list');

        if (items.length === 0) {
          list.innerHTML = '<li>No newspaper titles found.</li>';
        } else {
          for (let i = 0; i < items.length; i++) {
            const title = items[i].getElementsByTagName('title')[0]?.textContent;
            const link = items[i].getElementsByTagName('link')[0]?.textContent;

            if (title && link) {
              const li = document.createElement('li');
              const a = document.createElement('a');
              a.href = link;
              a.textContent = title;
              a.target = '_blank';
              li.appendChild(a);
              list.appendChild(li);
            }
          }
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        document.getElementById('titles-list').innerHTML = '<li>Failed to load titles.</li>';
      });
  </script>
</body>
</html>
